<!DOCTYPE html>
<html>
<head>
    <title>Test Export</title>
</head>
<body>
    <h1>Test Export Functions</h1>
    
    <div style="margin: 20px 0;">
        <h3>Test 1: Simple CSV Export</h3>
        <a href="/test-export-csv" target="_blank">
            <button style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px;">
                Download Simple CSV
            </button>
        </a>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test 2: PhpSpreadsheet CSV Export</h3>
        <a href="/test-export-phpspreadsheet" target="_blank">
            <button style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px;">
                Download PhpSpreadsheet CSV
            </button>
        </a>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test 3: Mitra Export (Actual)</h3>
        <a href="/mitras/export?export=csv" target="_blank">
            <button style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px;">
                Download Mitra CSV
            </button>
        </a>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test 4: Debug Export (No Middleware)</h3>
        <a href="/debug-mitra-export?export=csv" target="_blank">
            <button style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px;">
                Debug Mitra Export CSV
            </button>
        </a>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test 5: Debug Auth Check</h3>
        <a href="/debug-export" target="_blank">
            <button style="padding: 10px 20px; background: #ffc107; color: black; border: none; border-radius: 4px;">
                Check Authentication
            </button>
        </a>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test 6: JavaScript Export (Updated)</h3>
        <button id="jsExport" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px;">
            JavaScript Export Test
        </button>
    </div>
    
    <div id="results" style="margin: 20px 0; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
        <h4>Test Results & Status:</h4>
        <p><strong>Export Function Updated:</strong> Now using window.location.href for most reliable download</p>
        <p><strong>Backend:</strong> Added try-catch error handling and proper logging</p>
        <p><strong>Routes Available:</strong> All export routes properly registered</p>
        <p><strong>Dependencies:</strong> PhpSpreadsheet and all components working</p>
        <hr>
        <p><strong>Testing Order:</strong></p>
        <ol>
            <li>First test "Debug Auth Check" to verify you're logged in</li>
            <li>Test "Debug Mitra Export" (no middleware) to verify basic function</li>
            <li>Test "Download Mitra CSV" (with middleware) for full authentication</li>
            <li>Finally test in actual application at /mitras page</li>
        </ol>
        <p><em>Click the buttons above to test different export methods.</em></p>
    </div>

    <script>
        document.getElementById('jsExport').addEventListener('click', function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += '<p>Testing JavaScript export with Inertia approach...</p>';
            
            // Test direct URL approach
            try {
                const url = '/mitras/export?export=csv';
                resultsDiv.innerHTML += '<p>Trying direct URL: ' + url + '</p>';
                
                // Try window.location for authenticated route
                window.location.href = url;
                
                resultsDiv.innerHTML += '<p>✓ Direct navigation initiated</p>';
            } catch (error) {
                resultsDiv.innerHTML += '<p>✗ JavaScript error: ' + error.message + '</p>';
            }
        });
    </script>
</body>
</html>
